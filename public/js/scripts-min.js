"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,r){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==t.return||t.return()}finally{if(s)throw a}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function asyncGeneratorStep(e,r,t,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void t(e)}s.done?r(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise((function(n,o){var a=e.apply(r,t);function i(e){asyncGeneratorStep(a,n,o,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,o,i,s,"throw",e)}i(void 0)}))}}var menu=document.getElementById("menu"),menuButton=document.getElementById("menu-button"),form=document.getElementById("form"),linksContainer=document.getElementById("links-container"),spinner=document.getElementById("spinner"),links=[],showErrorButton=function(e){e.target.classList.add("shortened__copy--error"),e.target.textContent="Error",setTimeout((function(){e.target.classList.remove("shortened__copy--error"),e.target.textContent="Copy"}),3e3)},requestClipboardPermisions=function(){return navigator.permissions.query({name:"clipboard-write"}).then((function(e){return"granted"==e.state||"prompt"==e.state}))},syncLocalStorage=function(e,r){return localStorage.setItem(e,JSON.stringify(r))},printLinks=function(){var e=document.createDocumentFragment(),r=document.getElementById("template-link").content;linksContainer.textContent="",links.forEach((function(t){var n=r.querySelector(".shortened__link");n.textContent=t.url,n.href=t.url;var o=r.querySelector(".shortened__shortened-link");o.textContent=t.shortenedUrl,o.href=t.shortenedUrl;var a=r.querySelector(".shortened__copy");a.dataset.link=t.url,a.ariaLabel="Copy the shortened link from ".concat(t.url," to the clipboard");var i=document.importNode(r,!0);e.appendChild(i)})),linksContainer.appendChild(e),spinner.classList.remove("spinner--active")},showError=function(){form.url.setAttribute("aria-invalid","true"),form.url.classList.add("form__input--error"),form.url.parentElement.classList.add("form__input-container--error")},shortenUrl=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(r){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://api.shrtco.de/v2/shorten?url=".concat(r));case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n.result.full_short_link);case 10:e.prev=10,e.t0=e.catch(0),form.url.parentElement.dataset.error="We could not shorten that link",spinner.classList.remove("spinner--active"),showError(),console.error(e.t0);case 16:case 17:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(r){return e.apply(this,arguments)}}(),addLink=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(r){var t,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=_createForOfIteratorHelper(links),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=12;break}if(o=n.value,r!==o.url){e.next=10;break}return form.url.parentElement.dataset.error="This link has already been shortened",spinner.classList.remove("spinner--active"),showError(),e.abrupt("return");case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:return e.t1=r,e.next=24,shortenUrl(r);case 24:e.t2=e.sent,a={url:e.t1,shortenedUrl:e.t2},validateUrl(a.shortenedUrl)&&(links=[].concat(_toConsumableArray(links),[a]),syncLocalStorage("links",links),printLinks());case 27:case"end":return e.stop()}}),e,null,[[1,14,17,20]])})));return function(r){return e.apply(this,arguments)}}(),validateUrl=function(e){return!!/(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)+[a-z0-9][a-z0-9-]{0,61}[a-z0-9]/g.test(e)};menuButton.addEventListener("click",(function(){return menu.classList.toggle("navigation--active")})),form.addEventListener("submit",function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.preventDefault(),!validateUrl(form.url.value)){e.next=9;break}return form.url.setAttribute("aria-invalid","false"),form.url.classList.remove("form__input--error"),form.url.parentElement.classList.remove("form__input-container--error"),spinner.classList.add("spinner--active"),e.next=8,addLink(form.url.value);case 8:return e.abrupt("return");case 9:0==form.url.value.trim().length?form.url.parentElement.dataset.error="Please provide a link":form.url.parentElement.dataset.error="Please provide a valid link",showError();case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),linksContainer.addEventListener("click",(function(e){e.target.classList.contains("shortened__copy")&&(!requestClipboardPermisions()&&showErrorButton(e),navigator.clipboard.writeText(e.target.dataset.link).then((function(){e.target.classList.add("shortened__copy--copied"),e.target.textContent="Copied!",setTimeout((function(){e.target.classList.remove("shortened__copy--copied"),e.target.textContent="Copy"}),3e3)})).catch((function(){return showErrorButton(e)})))})),document.addEventListener("DOMContentLoaded",(function(){(links=JSON.parse(localStorage.getItem("links"))||[]).length>0&&printLinks()}));